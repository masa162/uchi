# ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¿è­·è¨­å®šã‚¬ã‚¤ãƒ‰

**ç›®çš„**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ã‚’é˜²æ­¢ã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é€šéã—ãŸã‚³ãƒ¼ãƒ‰ã®ã¿ãƒãƒ¼ã‚¸å¯èƒ½ã«ã™ã‚‹

---

## ğŸ›¡ï¸ ãƒ–ãƒ©ãƒ³ãƒä¿è­·ãƒ«ãƒ¼ãƒ«è¨­å®š

### æ‰‹å‹•è¨­å®šæ‰‹é †:

#### 1. GitHubè¨­å®šç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
```
https://github.com/masa162/uchi/settings/branches
```

#### 2. Branch protection ruleè¿½åŠ 
1. **"Add rule"** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **Branch name pattern**: `main`
3. ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–:

### ğŸ“‹ æ¨å¥¨ä¿è­·è¨­å®š

#### âœ… **åŸºæœ¬ä¿è­·**
- [ ] **Restrict pushes that create files larger than 100MB**
- [x] **Require a pull request before merging**
  - [x] Require approvals: **1**
  - [x] Dismiss stale PR approvals when new commits are pushed
  - [x] Require review from code owners (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

#### âœ… **CI/CDçµ±åˆ**
- [x] **Require status checks to pass before merging**
  - [x] Require branches to be up to date before merging
  - å¿…è¦ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯:
    - `lint-and-type-check`
    - `build-test` 
    - `test`
    - `ci-status`

#### âœ… **ç®¡ç†è€…ä¿è­·**
- [x] **Restrict pushes that create files larger than 100MB**
- [ ] **Allow force pushes** (ç·Šæ€¥æ™‚ã®ã¿)
- [ ] **Allow deletions** (ç·Šæ€¥æ™‚ã®ã¿)

---

## ğŸ”„ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹ç™ºãƒ•ãƒ­ãƒ¼

### é–‹ç™ºè€…å‘ã‘ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:

#### 1. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
```bash
git checkout -b feature/æ–°æ©Ÿèƒ½å
```

#### 2. é–‹ç™ºãƒ»ã‚³ãƒŸãƒƒãƒˆ
```bash
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½ã®å®Ÿè£…"
```

#### 3. ãƒ—ãƒƒã‚·ãƒ¥ãƒ»PRä½œæˆ
```bash
git push origin feature/æ–°æ©Ÿèƒ½å
```

#### 4. CIè‡ªå‹•å®Ÿè¡Œ
- TypeScriptå‹ãƒã‚§ãƒƒã‚¯
- Lintæ¤œè¨¼
- ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

#### 5. ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒãƒ¼ã‚¸
- CIæˆåŠŸå¾Œã€PRæ‰¿èª
- mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸
- è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

---

## ğŸš¨ ç·Šæ€¥æ™‚ã®å¯¾å¿œ

### æœ¬ç•ªéšœå®³æ™‚ã®ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹:

#### Option A: ç·Šæ€¥PR (æ¨å¥¨)
```bash
git checkout -b hotfix/ç·Šæ€¥ä¿®æ­£
# ä¿®æ­£ä½œæ¥­
git push origin hotfix/ç·Šæ€¥ä¿®æ­£
# ç·Šæ€¥PRä½œæˆãƒ»å³åº§ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒãƒ¼ã‚¸
```

#### Option B: ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ (æœ€çµ‚æ‰‹æ®µ)
1. ä¸€æ™‚çš„ã«ãƒ–ãƒ©ãƒ³ãƒä¿è­·ç„¡åŠ¹åŒ–
2. ç›´æ¥mainãƒ—ãƒƒã‚·ãƒ¥
3. å³åº§ã«ãƒ–ãƒ©ãƒ³ãƒä¿è­·å†æœ‰åŠ¹åŒ–

---

## ğŸ“Š CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆçŠ¶æ³

### ç¾åœ¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:

#### ğŸ  CI Pipeline (.github/workflows/ci.yml)
- **ãƒˆãƒªã‚¬ãƒ¼**: PRä½œæˆãƒ»push to main
- **ã‚¸ãƒ§ãƒ–**: lint-and-type-check â†’ build-test + test â†’ ci-status
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ç§˜å¯†æƒ…å ±ã‚¹ã‚­ãƒ£ãƒ³ (PRã®ã¿)

#### ğŸš€ Deploy Pipeline (.github/workflows/deploy.yml)  
- **ãƒˆãƒªã‚¬ãƒ¼**: push to main (CIæˆåŠŸå¾Œ)
- **å¯¾è±¡**: VPS (160.251.136.92)
- **ãƒ—ãƒ­ã‚»ã‚¹**: ã‚³ãƒ¼ãƒ‰æ›´æ–° â†’ ãƒ“ãƒ«ãƒ‰ â†’ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

---

## âœ… è¨­å®šç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ–ãƒ©ãƒ³ãƒä¿è­·è¨­å®š:
- [ ] main ãƒ–ãƒ©ãƒ³ãƒä¿è­·ãƒ«ãƒ¼ãƒ«ä½œæˆæ¸ˆã¿
- [ ] PRå¿…é ˆè¨­å®šæœ‰åŠ¹
- [ ] CI ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯å¿…é ˆè¨­å®š
- [ ] æ‰¿èªè€…1åå¿…é ˆè¨­å®š

### CI/CDè¨­å®š:
- [ ] GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª
- [ ] GitHub Secrets (VPS_SSH_KEY) è¨­å®šæ¸ˆã¿
- [ ] VPSè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ†ã‚¹ãƒˆæˆåŠŸ

### é–‹ç™ºãƒ•ãƒ­ãƒ¼:
- [ ] æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã§ã®é–‹ç™ºç¢ºèª
- [ ] PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
- [ ] ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ç­–å®š (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### CIå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³:

#### TypeScript ã‚¨ãƒ©ãƒ¼
```bash
npm run type-check
# ã‚¨ãƒ©ãƒ¼ä¿®æ­£å¾Œå†ã‚³ãƒŸãƒƒãƒˆ
```

#### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
```bash
npm run build
# ç’°å¢ƒå¤‰æ•°ãƒ»ä¾å­˜é–¢ä¿‚ç¢ºèª
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼
```bash
# ç§˜å¯†æƒ…å ±ãƒã‚¹ã‚¯åŒ–
find . -name "*.md" -exec sed -i 's/GOCSPX-[^"]*/"[MASKED]"/g' {} \;
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚:
1. VPS SSHæ¥ç¶šç¢ºèª
2. GitHub Secretsè¨­å®šç¢ºèª  
3. VPSå´ãƒ­ã‚°ç¢ºèª: `/var/www/uchi/deploy.log`