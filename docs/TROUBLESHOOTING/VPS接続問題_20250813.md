# VPS接続問題トラブルシューティング

**発生日時**: 2025年8月13日  
**問題**: SSH鍵認証エラーによるVPS接続不可  
**影響**: 本番環境デプロイ・修復作業が実行できない

---

## 🚨 現在の状況

### 確認済み事項
- **本番サイト**: https://uchinokiroku.com → 500 Internal Server Error
- **エラー原因**: TailwindCSS依存関係不足 (`Cannot find module 'tailwindcss'`)
- **SSH接続**: `Permission denied (publickey)`
- **最新コード**: GitHub main ブランチにプッシュ済み

### エラー詳細
```
Error: Cannot find module 'tailwindcss'
Require stack: /var/www/uchi/node_modules/next/dist/build/webpack/config/blocks/css/plugins.js
```

---

## 🔑 SSH接続問題の詳細

### 試行済み対処法
1. **SSH鍵権限修正**: `chmod 600 ~/.ssh/id_ed25519_sinvps_macbook`
2. **known_hosts更新**: `ssh-keygen -R 160.251.136.92`
3. **接続オプション調整**: `-o StrictHostKeyChecking=no`
4. **代替鍵試行**: `id_ed25519_masa162_macbook`

### エラー継続
```bash
ssh conoha-vps
root@160.251.136.92: Permission denied (publickey).
```

---

## 💡 推定原因・解決策

### 可能性の高い原因
1. **VPS側SSH鍵変更**: サーバー再構築時にauthorized_keysが変更
2. **権限問題**: VPS上の.sshディレクトリ権限
3. **鍵ペア不一致**: 登録済み公開鍵とローカル秘密鍵の不整合

### 必要な対応（ConoHaコントロールパネル）
1. **VPS状態確認**: 稼働状況・リソース使用量
2. **SSH鍵管理**: 登録済み公開鍵の確認・再登録
3. **コンソールアクセス**: Web console経由での直接アクセス
4. **再起動実行**: 必要に応じてVPS再起動

---

## 🛠️ 修復手順（VPS接続復旧後）

### 即座に実行するコマンド
```bash
# 1. アプリディレクトリに移動
cd /var/www/uchi

# 2. プロセス停止
pkill -f next

# 3. 最新コード取得
git fetch origin main
git reset --hard origin/main

# 4. 依存関係完全再インストール
rm -rf node_modules package-lock.json
npm install

# 5. 本番ビルド・起動
NODE_ENV=production npm run build
NODE_ENV=production npm start > app.log 2>&1 &

# 6. 動作確認
curl -I http://localhost:3000/
curl -I http://localhost:3000/articles/simple
```

### 修復完了の確認項目
- [ ] https://uchinokiroku.com → 200 OK
- [ ] /articles/simple → 簡易POST機能動作
- [ ] TailwindCSS → 正常なスタイル適用
- [ ] モバイル最適化 → レスポンシブ表示

---

## 📋 完了済み準備作業

### ✅ ローカル開発完了
- F001: 簡易POST機能実装完了
- F002: スマートフォンUI/UX最適化完了  
- TypeScript型安全性・パフォーマンス確認済み
- デプロイ可能状態でコミット・プッシュ完了

### ✅ 修復スクリプト準備
- `vps-fix-commands.sh`: 修復コマンド一覧作成
- 段階的修復手順ドキュメント化
- 動作確認項目リスト化

---

## 🚀 次のステップ

### 最優先（SSH接続復旧後）
1. TailwindCSS依存関係修復
2. 本番環境での簡易POST機能デプロイ
3. スマートフォン実機テスト実行

### 代替対応（接続困難時）
1. F003: 記事追加ページ調整をローカル継続
2. GitHub Actions経由での自動デプロイ検討
3. 新規VPSセットアップの検討

---

**作成者**: Claude Code Assistant  
**更新予定**: VPS接続復旧次第  
**緊急度**: 🔥 高（本番サイト停止中）